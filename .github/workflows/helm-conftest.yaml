name: Helm conftest
on: [pull_request]
jobs:
  check-charts:
    name: Run conftest for all charts
    runs-on: ubuntu-latest
    container:
      image: instrumenta/helm-conftest:latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        env:
          ACTIONS_ALLOW_USE_UNSECURE_NODE_VERSION: true  # https://github.com/actions/checkout/issues/1809

      - name: Validate all charts
        run: bash ci/helm-conftest.sh
